<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>WinGo Ultra AI - MADARA PRO</title>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBTTVVmV2J4A8QqG9gaTFjhTzDW6RqgNps",
            authDomain: "madara-62f7b.firebaseapp.com",
            projectId: "madara-62f7b",
            databaseURL: "https://madara-62f7b-default-rtdb.firebaseio.com",
            storageBucket: "madara-62f7b.firebasestorage.app",
            appId: "1:282972851212:web:64980ccdfa06b317357229"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        onValue(ref(db, 'prediction_control'), (snapshot) => {
            const data = snapshot.val() || { status: "ON" };
            const predCircles = document.getElementById('prediction-circles');
            const predStatus = document.getElementById('prediction-status-container');
            if(data.status === "OFF") {
                predCircles.style.display = "none";
                predStatus.style.display = "flex";
                predStatus.innerHTML = `<p>${data.message || 'System Maintenance'}</p>`;
            } else {
                predCircles.style.display = "grid";
                predStatus.style.display = "none";
            }
        });
    </script>

    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #fff5f5; overflow-x: hidden; }
        .wingo-app-container { max-width: 450px; margin: 0 auto; background-color: #ffffff; min-height: 100vh; padding-bottom: 20px; }
        
        /* Tab Styles with New Color #FFB3AE */
        .top-tabs-container { display: flex; padding: 10px 5px; gap: 5px; }
        .tab { display: flex; flex-direction: column; align-items: center; flex-grow: 1; padding: 10px 4px; border-radius: 12px; font-size: 11px; background-color: #fff0f0; color: #b35a55; cursor: pointer; transition: 0.1s; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .tab:before { content: ''; display: block; width: 22px; height: 22px; margin-bottom: 4px; background-image: url('https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000481654.png?alt=media'); background-size: contain; filter: hue-rotate(330deg); }
        .tab.active { background-color: #FFB3AE; color: #7a2b27; font-weight: bold; }
        
        .game-info-section { padding: 10px; display: flex; justify-content: center; }
        
        /* Card with New Color #FFB3AE Gradient */
        .info-card-container { display: flex; position: relative; background: linear-gradient(135deg, #FFB3AE 0%, #ffe4e2 100%); color: #7a2b27; border-radius: 12px; padding: 15px 12px; width: 92%; max-width: 400px; box-shadow: 0 6px 15px rgba(255, 179, 174, 0.4); overflow: hidden; mask-image: radial-gradient(circle at 50% 0, transparent 12px, black 13px), radial-gradient(circle at 50% 100%, transparent 12px, black 13px); -webkit-mask-image: radial-gradient(circle at 50% 0, transparent 12px, black 13px), radial-gradient(circle at 50% 100%, transparent 12px, black 13px); mask-composite: intersect; -webkit-mask-composite: source-in; }
        .info-card-container::before { content: ''; position: absolute; left: 50%; top: 10px; bottom: 10px; width: 1px; border-left: 2px dotted rgba(122,43,39,0.2); transform: translateX(-50%); }
        
        .info-left, .info-right { flex: 1; z-index: 1; display: flex; flex-direction: column; }
        .info-right { text-align: right; align-items: flex-end; }
        .label-text { font-size: 10px; font-weight: 700; color: #b35a55; margin-bottom: 6px; text-transform: uppercase; }
        
        .timer-display-container { display: flex; align-items: center; gap: 3px; }
        .timer-segment { background-color: #ffffff; color: #7a2b27; width: 20px; height: 28px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 16px; border-radius: 3px; clip-path: polygon(20% 0, 80% 0, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0 80%, 0 20%); }
        
        .recent-res-img { width: 22px; height: 22px; }
        .betting-numbers-container { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; min-height: 140px; }
        .number-image-wrapper img { width: 48px; height: 48px; transition: 0.2s; }
        
        /* History Navigation with New Color */
        .history-nav-container { display: flex; padding: 0 15px; gap: 4px; }
        .history-nav-btn { padding: 12px; cursor: pointer; background-color: #fff0f0; flex: 1; text-align: center; color: #b35a55; font-weight: bold; border-top-left-radius: 15px; border-top-right-radius: 15px; }
        .history-nav-btn.active { background-color: #FFB3AE; color: #7a2b27; }
        
        .history-table-wrapper { max-height: 400px; overflow-y: auto; border: 1px solid #ffe4e2; border-radius: 0 0 12px 12px; }
        table { width: 100%; border-collapse: collapse; background: white; text-align: center; }
        th { background: #FFB3AE; color: #7a2b27; padding: 10px 5px; font-size: 12px; position: sticky; top: 0; z-index: 2; }
        td { padding: 12px 5px; font-size: 13px; border-bottom: 1px solid #fff5f5; }
        .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }

        @keyframes sequentialJump {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
            50% { transform: translateY(-15px) scale(1.1); opacity: 1; }
        }
        .bounce-active { animation: sequentialJump 0.4s ease-in-out; }
    </style>
</head>
<body>

<div class="wingo-app-container">
    <div class="top-tabs-container">
        <div class="tab" onclick="changeMode('30s', this)">30s</div>
        <div class="tab active" onclick="changeMode('1 Min', this)">1 Min</div>
        <div class="tab" onclick="changeMode('3 Min', this)">3 Min</div>
        <div class="tab" onclick="changeMode('5 Min', this)">5 Min</div>
    </div>

    <div class="game-info-section">
        <div class="info-card-container">
            <div class="info-left">
                <div id="game-title" style="font-weight: 800; font-size: 14px; margin-bottom: 10px;">WinGo 1Min</div>
                <div class="label-text">Recent Results</div>
                <div id="recent-results-display" style="display: flex; gap: 4px;"></div>
            </div>
            <div class="info-right">
                <div class="label-text">Time Remaining</div>
                <div class="timer-display-container">
                    <span class="timer-segment" id="m1">0</span><span class="timer-segment" id="m2">0</span>
                    <span style="font-weight:bold; color:#7a2b27;">:</span>
                    <span class="timer-segment" id="s1">0</span><span class="timer-segment" id="s2">0</span>
                </div>
                <div style="font-size: 11px; font-weight: 700; color: #b35a55;"><span id="period-id">0000</span></div>
            </div>
        </div>
    </div>

    <div id="prediction-status-container"></div>
    <div class="betting-numbers-container" id="prediction-circles"></div>

    <div class="history-nav-container">
        <div id="game-history-btn" class="history-nav-btn active">Game History</div>
        <div id="my-history-btn" class="history-nav-btn">My History</div>
    </div>

    <div style="padding: 0 15px;">
        <div id="game-history-table" class="history-table-wrapper">
            <table>
                <thead><tr><th>Period</th><th>Number</th><th>Size</th><th>Color</th></tr></thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>
        <div id="my-history-content" class="history-table-wrapper" style="display:none;">
            <table>
                <thead><tr><th>Period</th><th>Prediction</th><th>Status</th></tr></thead>
                <tbody id="my-history-body"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const IMG = { 
        Q: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000481647.png?alt=media', 
        BIG: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000481648.png?alt=media', 
        SML: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000481650.png?alt=media' 
    };
    const NUM_IMG = { 0: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482339.png?alt=media', 1: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482340.png?alt=media', 2: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482341.png?alt=media', 3: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482342.png?alt=media', 4: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482343.png?alt=media', 5: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482344.png?alt=media', 6: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482345.png?alt=media', 7: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482346.png?alt=media', 8: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482347.png?alt=media', 9: 'https://firebasestorage.googleapis.com/v0/b/i-to-u.appspot.com/o/publicimage%2F1000482348.png?alt=media' };

    class ADXEngine {
        constructor() {
            this.rawHistory = { "30s": [], "1 Min": [], "3 Min": [], "5 Min": [] };
            this.userPredictions = { "30s": [], "1 Min": [], "3 Min": [], "5 Min": [] };
            this.consecutiveLosses = { "30s": 0, "1 Min": 0, "3 Min": 0, "5 Min": 0 };
            this.lastPrediction = { "30s": null, "1 Min": null, "3 Min": null, "5 Min": null };
        }

        predict(mode) {
            const history = this.rawHistory[mode];
            const losses = this.consecutiveLosses[mode];
            const lastPred = this.lastPrediction[mode];

            if (history.length < 3) return Math.random() > 0.5 ? "BIG" : "SMALL";

            const recent = history.slice(-20).map(r => ({ resultType: r }));
            const streak = this.getStreak(recent);

            // Logic 22: Loss Recovery (ADX 2.0)
            if (losses >= 2 && lastPred) return lastPred === "BIG" ? "SMALL" : "BIG";
            
            // Logic 1: Streak Detection (ADX 2.0)
            if (streak >= 3) return recent[recent.length - 1].resultType === "BIG" ? "SMALL" : "BIG";

            // Logic 6: Mirror Pattern (ADX 2.0)
            if (recent.length >= 4) {
                const s = recent.slice(-4);
                if (s[0].resultType === s[2].resultType && s[1].resultType === s[3].resultType && s[0].resultType !== s[1].resultType) {
                    return s[2].resultType;
                }
            }

            // Logic 8: Weighted Probability
            const bigs = recent.filter(r => r.resultType === "BIG").length;
            return bigs > recent.length / 2 ? "SMALL" : "BIG";
        }

        getStreak(recent) {
            const last = recent[recent.length - 1].resultType;
            let s = 0;
            for (let i = recent.length - 1; i >= 0; i--) {
                if (recent[i].resultType === last) s++; else break;
            }
            return s;
        }
    }

    const engine = new ADXEngine();
    let currentMode = "1 Min", lastPeriodStored = {}, isAnimating = false;

    window.changeMode = (mode, el) => {
        currentMode = mode;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('game-title').innerText = "WinGo " + mode;
        updateData(true);
    };

    async function updateData(modeSwitch = false) {
        try {
            const api = currentMode === "30s" ? "30S" : (currentMode === "1 Min" ? "1M" : (currentMode === "3 Min" ? "3M" : "5M"));
            const res = await fetch(`https://draw.ar-lottery01.com/WinGo/WinGo_${api}/GetHistoryIssuePage.json?ts=${Date.now()}`);
            const json = await res.json();
            const list = json.data.list;
            const currentP = list[0].issueNumber;
            const nextP = (BigInt(currentP) + 1n).toString();

            engine.rawHistory[currentMode] = list.slice(0, 50).reverse().map(i => parseInt(i.number) >= 5 ? "BIG" : "SMALL");

            if (currentP !== lastPeriodStored[currentMode]) {
                const prev = engine.userPredictions[currentMode][0];
                if (prev && prev.status === "Pending") {
                    const actual = parseInt(list[0].number) >= 5 ? "BIG" : "SMALL";
                    if (actual !== prev.pred) engine.consecutiveLosses[currentMode]++;
                    else engine.consecutiveLosses[currentMode] = 0;
                }
                lastPeriodStored[currentMode] = currentP;
                runAnimation(nextP);
            }
            renderTables(list);
        } catch(e) {}
    }

    function runAnimation(nextP) {
        if (isAnimating) return; isAnimating = true;
        document.getElementById('prediction-circles').innerHTML = Array.from({length:10}, (_,i) => `<div class="number-image-wrapper" id="ball-${i}"><img src="${IMG.Q}" style="opacity:0.6;"></div>`).join('');
        let loops = 0;
        const interval = setInterval(() => {
            document.querySelectorAll('.number-image-wrapper img').forEach(img => img.classList.remove('bounce-active'));
            const ball = document.getElementById(`ball-${loops % 10}`);
            if(ball) ball.querySelector('img').classList.add('bounce-active');
            loops++;
            if (loops > 15) { clearInterval(interval); isAnimating = false; showFinalPrediction(nextP); }
        }, 120);
    }

    function showFinalPrediction(nextP) {
        const p = engine.predict(currentMode);
        const stop = Math.floor(Math.random() * 10);
        const html = Array.from({length:10}, (_,i) => {
            const isW = i === stop;
            const s = isW ? 'style="transform:scale(1.2);"' : 'style="opacity:0.6;"';
            return `<div class="number-image-wrapper"><img src="${isW ? (p==='BIG'?IMG.BIG:IMG.SML) : IMG.Q}" ${s}></div>`;
        }).join('');
        document.getElementById('prediction-circles').innerHTML = html;
        if (!engine.userPredictions[currentMode].some(u => u.period === nextP)) {
            engine.lastPrediction[currentMode] = p;
            engine.userPredictions[currentMode].unshift({ period: nextP, pred: p, status: "Pending" });
            updateMyHistoryUI();
        }
    }

    function renderTables(list) {
        document.getElementById('period-id').textContent = (BigInt(list[0].issueNumber) + 1n).toString();
        document.getElementById('recent-results-display').innerHTML = list.slice(0, 4).map(i => `<img src="${NUM_IMG[parseInt(i.number)]}" class="recent-res-img">`).join('');
        document.getElementById('history-body').innerHTML = list.slice(0, 10).map(i => {
            const n = parseInt(i.number), c = (n==0||n==5) ? '#a020f0' : (n%2==0 ? '#ff3366' : '#279010');
            return `<tr><td>${i.issueNumber}</td><td style="color:${c};font-weight:bold">${n}</td><td>${n>=5?'Big':'Small'}</td><td><span class="dot" style="background:${c}"></span></td></tr>`;
        }).join('');
        engine.userPredictions[currentMode].forEach(u => {
            const m = list.find(l => l.issueNumber === u.period);
            if(m) u.status = (u.pred === (parseInt(m.number) >= 5 ? "BIG" : "SMALL")) ? "WIN" : "LOSS";
        });
        updateMyHistoryUI();
    }

    function updateMyHistoryUI() {
        const hist = engine.userPredictions[currentMode] || [];
        document.getElementById('my-history-body').innerHTML = hist.map(u => `<tr><td>${u.period}</td><td>${u.pred}</td><td style="color:${u.status==='WIN'?'#279010':(u.status==='LOSS'?'#ff3366':'orange')}; font-weight:bold;">${u.status}</td></tr>`).join('');
    }

    setInterval(() => {
        const now = new Date();
        const sTotal = now.getSeconds() + now.getMinutes() * 60;
        let t = currentMode==="30s" ? 30 : (currentMode==="3 Min" ? 180 : (currentMode==="5 Min" ? 300 : 60));
        let rem = t - (sTotal % t);
        document.getElementById('m1').textContent = "0"; document.getElementById('m2').textContent = Math.floor(rem/60);
        document.getElementById('s1').textContent = Math.floor((rem%60)/10); document.getElementById('s2').textContent = (rem%60)%10;
        if (rem === t || rem === 1) updateData();
    }, 1000);

    window.onload = () => updateData();
    document.getElementById('game-history-btn').onclick = () => { document.getElementById('game-history-table').style.display='block'; document.getElementById('my-history-content').style.display='none'; document.getElementById('game-history-btn').classList.add('active'); document.getElementById('my-history-btn').classList.remove('active'); };
    document.getElementById('my-history-btn').onclick = () => { document.getElementById('my-history-content').style.display='block'; document.getElementById('game-history-table').style.display='none'; document.getElementById('my-history-btn').classList.add('active'); document.getElementById('game-history-btn').classList.remove('active'); updateMyHistoryUI(); };
</script>
</body>
</html>
